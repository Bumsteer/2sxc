/*! ToSic_ToSxc 2015-06-26 */

!function(){var a=angular.module("2sxc.view",["2sxc4ng","pascalprecht.translate"]);a.config(["$translateProvider","AppInstanceId",function(a,b){var c=$2sxc(b).manage._manageInfo;a.preferredLanguage(c.lang).useSanitizeValueStrategy("escape").fallbackLanguage(c.fallbackLang).useStaticFilesLoader({prefix:c.applicationRoot+"desktopmodules/tosic_sexycontent/i18n/inpage-",suffix:".js"})}]),a.controller("TemplateSelectorCtrl",["$scope","$attrs","moduleApiService","$filter","$q","$window",function(a,b,c,d,e,f){var g=this,h=a,i=b.moduleid,j=c(i);g.manageInfo=$2sxc(i).manage._manageInfo,g.apps=[],g.contentTypes=[],g.templates=[],g.filteredTemplates=function(a){return g.manageInfo.isContentApp?d("filter")(g.templates,"_LayoutElement"==a?{ContentTypeStaticName:""}:{ContentTypeStaticName:a},!0):g.templates},g.contentTypeId=g.manageInfo.contentTypeId,g.templateId=g.manageInfo.templateId,g.savedTemplateId=g.manageInfo.templateId,g.appId=g.manageInfo.appId,g.savedAppId=g.manageInfo.appId,g.loading=0,g.reloadTemplates=function(){g.loading++;var a=j.getSelectableContentTypes(),b=j.getSelectableTemplates();e.all([a,b]).then(function(a){g.contentTypes=a[0].data,g.templates=a[1].data,d("filter")(g.templates,{ContentTypeStaticName:""},!0).length>0&&(g.contentTypes.push({StaticName:"_LayoutElement",Name:"Layout element"}),g.contentTypes=d("orderBy")(g.contentTypes,"Name")),g.loading--})},h.$watch("vm.templateId",function(a,b){if(a!=b)if(g.manageInfo.isContentApp)g.renderTemplate(a);else{g.loading++;var c;c=g.manageInfo.hasContent?g.saveTemplateId(a):g.setPreviewTemplateId(a),c.then(function(){f.location.reload()})}}),h.$watch("vm.contentTypeId",function(a,b){if(a!=b){var c=g.filteredTemplates(a)[0].TemplateId;g.templateId!=c&&null!=c&&(g.templateId=c)}}),null!=g.appId&&g.manageInfo.templateChooserVisible&&g.reloadTemplates(),h.$watch("vm.manageInfo.templateChooserVisible",function(a,b){a!=b&&null!=g.appId&&a&&g.reloadTemplates()}),h.$watch("vm.appId",function(a,c){return a!=c&&null!=a?-1==a?void(window.location=b.importappdialog):void j.setAppId(a).then(function(){f.location.reload()}):void 0}),g.manageInfo.isContentApp||j.getSelectableApps().then(function(a){g.apps=a.data,g.apps.push({Name:b.importapptext,AppId:-1})}),g.setTemplateChooserState=function(a){return a||(g.templateId=g.savedTemplateId),j.setTemplateChooserState(a).then(function(){g.manageInfo.templateChooserVisible=a})},g.saveTemplateId=function(){var a=[];return g.manageInfo.hasContent&&g.savedTemplateId==g.templateId||(a.push(j.saveTemplateId(g.templateId)),g.savedTemplateId=g.templateId,a.push(g.setTemplateChooserState(!1))),e.all(a)},g.setPreviewTemplateId=function(){return j.setPreviewTemplateId(g.templateId)},g.renderTemplate=function(a){g.loading++,j.renderTemplate(a).then(function(a){try{g.insertRenderedTemplate(a.data),$2sxc(i).manage._processToolbars()}catch(b){console.log("Error while rendering template:"),console.log(b)}g.loading--})},g.insertRenderedTemplate=function(a){$(".DnnModule-"+i+" .sc-viewport").html(a)},g.addItem=function(a){j.addItem(a).then(function(){g.renderTemplate(g.templateId)})},g.removeFromList=function(a){j.removeFromList(a).then(function(){g.renderTemplate(g.templateId)})},g.changeOrder=function(a,b){j.changeOrder(a,b).then(function(){g.renderTemplate(g.templateId)})}}]),a.factory("moduleApiService",["$http",function(a){return function(b){function c(b,c){return a(c)}return{saveTemplateId:function(a){return c(b,{url:"View/Module/SaveTemplateId",params:{templateId:a}})},setPreviewTemplateId:function(a){return c(b,{url:"View/Module/SetPreviewTemplateId",params:{templateId:a}})},addItem:function(a){return c(b,{url:"View/Module/AddItem",params:{sortOrder:a}})},getSelectableApps:function(){return c(b,{url:"View/Module/GetSelectableApps"})},setAppId:function(a){return c(b,{url:"View/Module/SetAppId",params:{appId:a}})},getSelectableContentTypes:function(){return c(b,{url:"View/Module/GetSelectableContentTypes"})},getSelectableTemplates:function(){return c(b,{url:"View/Module/GetSelectableTemplates"})},setTemplateChooserState:function(a){return c(b,{url:"View/Module/SetTemplateChooserState",params:{state:a}})},renderTemplate:function(a){return c(b,{url:"View/Module/RenderTemplate",params:{templateId:a}})},changeOrder:function(a,d){return c(b,{url:"View/Module/ChangeOrder",params:{sortOrder:a,destinationSortOrder:d}})},removeFromList:function(a){return c(b,{url:"View/Module/RemoveFromList",params:{sortOrder:a}})}}}}])}();
//# sourceMappingURL=template-selector.min.js.map